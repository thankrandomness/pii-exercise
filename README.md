# üõ°Ô∏è PII Redaction Pipeline

This repository implements a serverless pipeline for redacting personally identifiable information (PII) from voice metadata stored as JSON in S3. It uses Amazon Comprehend, Macie, and EventBridge to ensure privacy, compliance, and continuous model improvement.

---

## System Design Diagram

A detailed system design diagram shows the full data flow across:

- Raw ingestion
- Comprehend-based redaction
- Macie validation
- Feedback loop and CER retraining

<p align="center">
  <img src="./system_design.png" alt="PII Redaction Pipeline" width="700"/>
</p>

The architecture is designed to process high-volume voice metadata files, redact sensitive content using Amazon Comprehend, validate using Macie, and continuously improve through feedback and retraining.

## üîÑ Data Flow Description

### 1. üì® Raw File Ingestion

Files are uploaded to **`S3: Raw`**, which stores the unprocessed call transcripts.

- **Justification**: S3 is a durable, event-driven storage layer that integrates directly with Lambda.
- **Security**: Encrypted using SSE-KMS; bucket policies restrict access.
- **Scalability**: Scales to petabytes of input volume without performance degradation.


### 2. üßº Redaction via Lambda + Comprehend

A new file triggers the **`Lambda: RedactPII`**, which uses **Amazon Comprehend** to detect and redact sensitive data. Redacted files are written to **`S3: Redacted`**.

- **Justification**: Lambda offers serverless, per-file parallelism. Comprehend supports PII detection out of the box.
- **Security**: Lambda has scoped permissions to access only specific buckets and services.
- **Scalability**: Redaction is event-driven and horizontally scalable.

### 3. üïµÔ∏è Validation using Macie

Redacted files are scanned by **Macie**, which checks for any residual PII. Findings are published to **`EventBridge: PII Leaks`**.

- **Justification**: Macie serves as an external quality gate and secondary classifier.
- **Security**: Findings are logged and routed securely; sensitive access is audited.
- **Scalability**: Macie supports both on-demand and scheduled scans at scale.

### 4. üö® Quarantine Pipeline

If Macie detects leaked PII, **`Lambda: Copy Raw Data`** moves the original file to **`S3: Quarantine`** for investigation.

- **Justification**: Prevents failed redactions from contaminating production data.
- **Security**: Quarantine access is tightly controlled for incident response teams.
- **Scalability**: Each file is handled as an independent async event.

### 5. üß™ Quarantine Re-Scan

Quarantined files undergo another **Macie** scan. The findings are published to **`EventBridge: Quarantine`** for deeper inspection.

### 6. üîÅ Feedback Extraction

**`Lambda: Extract Patterns`** parses findings from Macie, extracts labeled examples, and writes them to **`S3: CER Training Dataset`**.

- **Justification**: Enables self-improving redaction by learning from real data failures.
- **Security**: Lambda has write-only access to the training path.
- **Scalability**: Works efficiently at event scale; training data can be accumulated over time.

### 7. üß† Custom Entity Recognizer (CER)

The **Comprehend CER** is retrained using data from the training dataset, improving future redaction precision.

- **Justification**: CER allows adapting to domain-specific PII patterns.
- **Security**: Training jobs run with isolated permissions and use versioned models.
- **Scalability**: Managed by Comprehend; supports large training sets and retraining frequency as needed.

---

## ‚úÖ Human-in-the-Loop Review Points

| Stage                     | Human Responsibility                                  |
| ------------------------- | ----------------------------------------------------- |
| Macie SNS Alert           | Investigate PII leak patterns                         |
| Quarantine File Review    | Label sentences for new PII patterns                  |
| CER Dataset Curation      | Review CSV/JSONL files generated by Lambda            |
| CER Training Launch       | Trigger training job (manual or automated)            |
| Model Deployment Approval | Validate updated model performance before redeploying |

